<nav class="navbar navbar-default">
  <%= form_tag({controller: 'observer', action: 'pattern_search'}, {class: "navbar-form navbar-left"}) do %>
      <div class="form-group">
        <div class="icon-addon addon-sm  inline">
          <%= text_field(:search, :pattern, value: session[:pattern], class: "form-control", placeholder: :app_find.t) %>
          <label for="search_pattern" class="glyphicon glyphicon-search" title="search"> </label>
        </div>
        <%= options = [
                [:COMMENTS.l, :comment],
                [:HERBARIA.l, :herbarium],
                [:IMAGES.l, :image],
                [:LOCATIONS.l, :location],
                [:NAMES.l, :name],
                [:OBSERVATIONS.l, :observation],
                [:PROJECTS.l, :project],
                [:SPECIES_LISTS.l, :species_list],
                [:SPECIMENS.l, :specimen],
                [:USERS.l, :user],
                [:app_search_google.l, :google],
        ].sort
            select(:search, :type, options_for_select(options, session[:search_type] || :observation), {},
                   {class: "form-control align-top"}) %>
        <%= submit_tag :app_search.l, class: "btn btn-default align-top" %>

      </div>
      <div id="timer_container" class="align-top">
        <div id="timer" class="small">
          <% if @timer_start %>
                <%=
                    @timer_end ||= Time.now
                    secs = '%.2f' % (@timer_end.to_f - @timer_start.to_f)
                    @timer_start = nil
                    "(#{:app_index_timer.t(:seconds => secs, :num => @num_results.to_i)})"
                %>
          <% end %>
        </div>
        <%= link_to(:app_advanced_search.l.nowrap, :controller => 'observer', :action => 'advanced_search_form') %>
      </div>
  <% end %>

  <ul class="nav navbar-nav navbar-right hidden-xs" style="margin-right: 0">
    <% if @user.nil? %>
        <div class="nav navbar-form">
          <%= link_to(:app_login.t, {controller: 'account', action: 'login'}, {class: "btn btn-primary align-bottom"}) %>
          <%= link_to(:app_create_account.t, {controller: 'account', action: 'signup'}, {class: "btn btn-primary align-bottom"}) %>
        </div>

    <% else ##user is logged in %>
        <li>
          <%= link_to('', {controller: 'comment', action: 'show_comments_for_user', id: @user.id},
                        {class: "glyphicon glyphicon-inbox", title: :app_comments_for_you.t,
                         data: {toggle: "tooltip", placement: "left"}        }) %>
        </li>
        <li>
          <%= link_to('', {controller: 'interest', action: 'list_interests'},
                        {class: "glyphicon glyphicon-bullhorn", title: :app_your_interests.t,
                         data: {toggle: "tooltip", placement: "left"}      }) %>
        </li>
        <li>
          <%= link_to('', {controller: 'account', action: 'prefs'},
                      {class: "glyphicon glyphicon-cog", title: :app_preferences.t,
                       data: {toggle: "tooltip", placement: "left"}      }) %>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" style="color:black">
            <%= h(@user.login) %>
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li><%= link_to(:app_your_observations.t, {controller: 'observer', action: 'observations_by_user', id: @user.id}, {class: ""}) %></li>
            <li><%= link_to(:app_your_interests.t, {controller: 'interest', action: 'list_interests'}, {class: ""}) %></li>
            <li><%= link_to(:app_your_summary.t, {controller: 'observer', action: 'show_user', id: @user.id}, {class: ""}) %></li>
            <li><%= link_to(:app_preferences.t, {controller: 'account', action: 'prefs'}, {class: ""}) %></li>
            <li class="divider"></li>
            <li><%= link_to(:app_logout.t, {controller: 'account', action: 'logout_user'}) %></li>
          </ul>
        </li>
        <li> <%= link_to('', {controller: 'account', action: 'logout_user'},
                         {class: "glyphicon glyphicon-log-out", title: :app_logout.t,
                          data: {toggle: "tooltip", placement: "left"},
                          style: "padding-right: 10px" }) %>
        </li>
    <% end %>
  </ul>
</nav>